<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="docs,testNG," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="记录一些最近在做平台测试方案的时候，碰到的一些testNG相关的问题。">
<meta property="og:type" content="article">
<meta property="og:title" content="testNG一些总结">
<meta property="og:url" content="http://yoursite.com/2016/12/14/test/testNG的一些总结/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="记录一些最近在做平台测试方案的时候，碰到的一些testNG相关的问题。">
<meta property="og:updated_time" content="2017-04-27T14:39:49.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="testNG一些总结">
<meta name="twitter:description" content="记录一些最近在做平台测试方案的时候，碰到的一些testNG相关的问题。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/12/14/test/testNG的一些总结/"/>





  <title> testNG一些总结 | Hexo </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/14/test/testNG的一些总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                testNG一些总结
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-14T13:18:12+08:00">
                2016-12-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/test/" itemprop="url" rel="index">
                    <span itemprop="name">test</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>记录一些最近在做平台测试方案的时候，碰到的一些testNG相关的问题。</p>
</blockquote>
<a id="more"></a>
<h1 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h1><h2 id="group怎么取交集"><a href="#group怎么取交集" class="headerlink" title="group怎么取交集"></a>group怎么取交集</h2><p>// TODO 深坑待入</p>
<h2 id="关于并发和执行顺序"><a href="#关于并发和执行顺序" class="headerlink" title="关于并发和执行顺序"></a>关于并发和执行顺序</h2><ul>
<li>涉及到的配置项，主要有<code>parallel， group-by-instances，priority，preserve-order</code></li>
<li>parallel+thread-count规定了testNG是否在testNG level并发运行，以及在什么层面进行并发</li>
</ul>
<p>还原当时场景：</p>
<blockquote>
<ul>
<li>testNG单线程运行classes</li>
<li>classes之间的顺序无所谓</li>
<li>class中的methods要相邻运行，并且有序</li>
</ul>
</blockquote>
<p>国际惯例，testNG版本是：</p>
<pre><code>&lt;groupId&gt;org.testng&lt;/groupId&gt;
&lt;artifactId&gt;testng&lt;/artifactId&gt;
&lt;version&gt;6.9.10&lt;/version&gt;
</code></pre><p>一开始<code>parallel=false</code>，放到CI运行，发现method顺序不对。如果不指定<code>priority</code>，那么testNG默认是按照方法的字母序跑的，不好玩。具体可以参考这个：<a href="http://stackoverflow.com/questions/26632241/priority-in-testng-with-multiple-classes" target="_blank" rel="external">priority-in-testng-with-multiple-classes</a></p>
<p>所以改进，方案是：</p>
<blockquote>
<p>除了before &amp; after方法之外，都加了priority，并确保顺序正确</p>
</blockquote>
<p>但是每个classes中指定了priority之后，一个class中的到是没问题了，可当testNG运行多个classes的时候，priority的scope扩展到了全部的classes，即先运行的是priority=1的方法，不管这个method在那个类，心塞，:(</p>
<p>继续查，找到了一个配置：<code>group-by-instances</code>，看介绍，配置<code>group-by-instances=true</code>之后，testNG就会按照所谓instances顺序运行了。在简单的demo测试中也确实是这样。but迁移到实际场景测试的时候，发现报了个错:</p>
<blockquote>
<p>No free nodes found in:[DynamicGraph</p>
</blockquote>
<p>好坑爹，搜了下貌似没什么靠谱的解释，可能进一步需要跟进源码搞搞了。</p>
<p>不过实验出来一个解决方案，是修改<code>parallel=tests</code>，再在CI运行，就达到了开头的场景需求。</p>
<p>—update on 20161215</p>
<p>在通过blockqueue实现了框架对test env的管理以后，对testNG运行的需求变成了</p>
<blockquote>
<ul>
<li>testNG classes level parallel</li>
<li>classes之间的顺序无所谓</li>
<li>class中的methods要相邻运行，并且有序</li>
</ul>
</blockquote>
<p>ok那其实就更简单了，修改配置：</p>
<ul>
<li><code>parallel=classes</code></li>
<li>删除<code>group-by-instances=true</code></li>
</ul>
<p>就达到目的了</p>
<p>另外吐槽下，官网文档指出可以通过实现：<code>IMethodInterceptor</code>来控制不存在dependency的method的order（<a href="http://testng.org/doc/documentation-main.html#methodinterceptors" target="_blank" rel="external">戳这里</a>）</p>
<blockquote>
<ul>
<li>Methods run sequentially. These are all the test methods that have dependencies or dependents. These methods will be run in a specific order.</li>
<li>Methods run in no particular order. These are all the methods that don’t belong in the first category. The order in which these test methods are run is random and can vary from one run to the next (although by default, TestNG will try to group test methods by class).</li>
</ul>
</blockquote>
<p>呸这是官方坑啊。。测试了顺序这个点并没有什么用，但是filter功能还是好使的，后续可以跟进一个issue来验证下。</p>
<p>相关的一些文档，记录一下：</p>
<ul>
<li><a href="https://rationaleemotions.wordpress.com/2016/08/17/how-to-run-test-methods-in-parallel-but-test-classes-in-sequence/" target="_blank" rel="external">How to run test methods in parallel but test classes in sequence</a></li>
<li><a href="http://stackoverflow.com/questions/33836465/what-does-preserve-order-and-group-by-instances-mean-in-testng" target="_blank" rel="external">preserve-order和group-by-instances</a></li>
</ul>
<h2 id="instance是个什么鬼"><a href="#instance是个什么鬼" class="headerlink" title="instance是个什么鬼"></a>instance是个什么鬼</h2><p>把log变量设置为：<code>verbose=10</code>，可以看到这个instance的相关log，需要更深入的研究</p>
<p>// TODO:</p>
<h2 id="test-method-fail相关处理"><a href="#test-method-fail相关处理" class="headerlink" title="test method fail相关处理"></a>test method fail相关处理</h2><p>写测试用例并运行，避免不了用例的失败。有些策略和方法，跟其相关的，整理在了这里。</p>
<h3 id="挂我一个大家都挂"><a href="#挂我一个大家都挂" class="headerlink" title="挂我一个大家都挂"></a>挂我一个大家都挂</h3><p>一般对待测试method失败，有两种case比较常见：</p>
<blockquote>
<ul>
<li>冒烟测试，hin重要，追求时效性，挂了其他测试也不用跑了，立刻stop并通知</li>
<li>挂了统计下就好了，不影响其他</li>
</ul>
</blockquote>
<p>testng原生配置中，相关的有：<code>configfailurepolicy</code>，<code>alwaysRun</code></p>
<p>先说<code>configfailurepolicy</code></p>
<p>他的作用是控制了@beforeClass这种，执行失败后是否需要继续。具体可以戳<a href="http://testng.org/doc/documentation-main.html" target="_blank" rel="external">官网配置</a></p>
<p>而<code>alwaysRun</code>就分三类咯：</p>
<ul>
<li>配置在@beforeXXX上面</li>
<li>配置在@afterXXX上面</li>
<li>配置在@Test上面</li>
</ul>
<blockquote>
<p>配置在@beforeXXX上面：For before methods (beforeSuite, beforeTest, beforeTestClass and beforeTestMethod, but not beforeGroups): If set to true, this configuration method will be run regardless of what groups it belongs to. </p>
</blockquote>
<p>这个实践没用到，看样子可以考虑用在dependency的服务上，如log或者counter什么之类的。</p>
<blockquote>
<p>配置在@afterXXX上面：For after methods (afterSuite, afterClass, …): If set to true, this configuration method will be run even if one or more methods invoked previously failed or was skipped</p>
</blockquote>
<p>这个比较实用，类似finally的概念</p>
<blockquote>
<p>配置在@Test上面：If set to true, this test method will always be run even if it depends on a method that failed.</p>
</blockquote>
<p>因为method没使用dependency机制去维护，故这里也没用到。就算用，应该也是在classes的Test level，而非method。要不不得累死。</p>
<p>并且需要注意的地方是，alwaysRun比tesng中，test的配置<code>enable=false</code>的优先级是高的。具体如：<br>class的@Test配置了<code>enable=false</code>，而@AfterClass配置了<code>alwaysRun=true</code>，这时候包括<code>@BeforeClass</code>都没运行，而<code>@AfterClass</code>运行了，比较坑爹。</p>
<p>但但但是，针对上面的case，如果<code>@AfterClass</code>本身配置了<code>enable=false</code>，则<code>@AfterClass</code>就不会运行了。这应该也算是config生效的一种约定吧。</p>
<h3 id="command执行test的最终结果"><a href="#command执行test的最终结果" class="headerlink" title="command执行test的最终结果"></a>command执行test的最终结果</h3><p>我用的是maven-surefire-plugin+testng的方式。surefire提供了一个配置项</p>
<blockquote>
<p>testFailureIgnore, 默认是false</p>
</blockquote>
<ul>
<li>testFailureIgnore=true，method就算有失败，exit code也是0</li>
<li>testFailureIgnore=false，method只有全部pass，exit code才是0</li>
</ul>
<p>如果真的使用exit code做些判断，则需要当心了</p>
<h2 id="parallel-classes-amp-dependsOnMethod的坑"><a href="#parallel-classes-amp-dependsOnMethod的坑" class="headerlink" title="parallel=classes&amp;dependsOnMethod的坑"></a>parallel=classes&amp;dependsOnMethod的坑</h2><p>hans的自动化方案中，class之间是完全解耦的，但是在class内部，method之间，为了避免默认字母序，还是需要顺序依赖的。testNG中能利用的方案有：</p>
<ul>
<li>priority</li>
<li>dependsOnMethod</li>
</ul>
<p>测试的时候发现一个坑，就是当parallel=classes&amp;存在dependsOnMethod的时候，可能导致methodA运行完之后，methodDependsOnA被切换到另一个thread去运行。这样其实是对parallel=classes的一个破坏:(</p>
<p>官方github issue中也有记录：<a href="https://github.com/cbeust/testng/issues/1185" target="_blank" rel="external">DependsOnMethods made parallel class use several threads</a></p>
<p>发现问题的版本是：6.9.12 and 6.9.13.8，继续跟进这个问题吧。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>发现了一个jenkins的插件，不知道是否会有用，记录下先<ul>
<li><a href="https://wiki.jenkins-ci.org/display/JENKINS/Test+Results+Analyzer+Plugin" target="_blank" rel="external">地址戳这里</a></li>
<li>看了下，大概是count多个build中test的汇总</li>
<li>汇总蛮有意思，chart也是，但是不知道能否展示或者搞log</li>
</ul>
</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/docs/" rel="tag"># docs</a>
          
            <a href="/tags/testNG/" rel="tag"># testNG</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/13/linux/IPMI资料/" rel="next" title="IPMI资料">
                <i class="fa fa-chevron-left"></i> IPMI资料
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/12/17/pm/code-review/" rel="prev" title="code review">
                code review <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="John Doe" />
          <p class="site-author-name" itemprop="name">John Doe</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">55</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#FAQ"><span class="nav-number">1.</span> <span class="nav-text">FAQ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#group怎么取交集"><span class="nav-number">1.1.</span> <span class="nav-text">group怎么取交集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关于并发和执行顺序"><span class="nav-number">1.2.</span> <span class="nav-text">关于并发和执行顺序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#instance是个什么鬼"><span class="nav-number">1.3.</span> <span class="nav-text">instance是个什么鬼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#test-method-fail相关处理"><span class="nav-number">1.4.</span> <span class="nav-text">test method fail相关处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#挂我一个大家都挂"><span class="nav-number">1.4.1.</span> <span class="nav-text">挂我一个大家都挂</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#command执行test的最终结果"><span class="nav-number">1.4.2.</span> <span class="nav-text">command执行test的最终结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#parallel-classes-amp-dependsOnMethod的坑"><span class="nav-number">1.5.</span> <span class="nav-text">parallel=classes&dependsOnMethod的坑</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考资料"><span class="nav-number">2.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  






  





  

  

  

  

</body>
</html>
